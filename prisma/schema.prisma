// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
}

model User {
  id        String   @id @default(cuid())
  email     String   @unique
  name      String?
  password  String
  role      String   @default("user") // user, admin
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  // Subscription info
  stripeCustomerId       String?   @unique
  stripeSubscriptionId   String?   @unique
  stripePriceId          String?
  stripeCurrentPeriodEnd DateTime?
  subscriptionTier       String?   // starter, professional, enterprise
  subscriptionStatus     String?   // active, canceled, past_due, trialing

  // Usage tracking
  coursesCreatedThisMonth Int      @default(0)
  videosCreatedThisMonth  Int      @default(0)
  quizzesCreatedThisMonth Int      @default(0)
  usageResetDate          DateTime @default(now())

  // Relations
  courses Course[]
  videos  Video[]
  quizzes Quiz[]

  @@index([email])
  @@index([stripeCustomerId])
  @@index([stripeSubscriptionId])
}

model Course {
  id          String   @id @default(cuid())
  userId      String
  title       String
  description String?
  level       String?  // beginner, intermediate, advanced
  duration    Int?     // in weeks
  content     Json     // AI-generated course structure
  status      String   @default("draft") // draft, published
  templateId  String?  // Reference to template for PDF export styling
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  user     User      @relation(fields: [userId], references: [id], onDelete: Cascade)
  template Template? @relation(fields: [templateId], references: [id])

  @@index([userId])
  @@index([status])
  @@index([templateId])
}

model Video {
  id          String   @id @default(cuid())
  userId      String
  title       String
  description String?
  duration    Int?     // in minutes
  style       String?  // professional, casual, academic, energetic
  script      Json     // AI-generated video script
  status      String   @default("draft") // draft, published
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  user User @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId])
  @@index([status])
}

model Quiz {
  id          String   @id @default(cuid())
  userId      String
  title       String
  description String?
  topic       String?
  difficulty  String?  // beginner, intermediate, advanced
  questions   Json     // AI-generated quiz questions
  status      String   @default("draft") // draft, published
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  user User @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId])
  @@index([status])
}

model Template {
  id          String   @id @default(cuid())
  name        String
  description String?
  category    String   // business, education, creative, professional, minimal, elegant
  tier        String   // free, starter, professional, enterprise
  thumbnail   String?  // URL or path to preview image
  fonts       Json     // Font configuration: { heading: "...", body: "...", accent: "..." }
  colors      Json     // Color scheme: { primary: "...", secondary: "...", accent: "...", background: "..." }
  clipArt     Json     // Clip art assets: { icons: [], decorations: [], borders: [] }
  layout      Json     // Layout configuration for PDF export
  isActive    Boolean  @default(true)
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  courses Course[]

  @@index([tier])
  @@index([category])
  @@index([isActive])
}
