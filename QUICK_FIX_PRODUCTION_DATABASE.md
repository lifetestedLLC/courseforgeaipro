# Quick Fix: Production Database Connection Error

## The Problem

You're seeing this error on https://www.courseforgeai.org:
```
Invalid `prisma.user.findUnique()` invocation: Can't reach database server at 127.0.0.1:51214
```

## Why It Happens

- **Local development** (localhost:3000) works ‚úÖ
- **Production** (www.courseforgeai.org) fails ‚ùå

**Root Cause:** Your production site is trying to use a local database connection (`127.0.0.1:51214`) which only exists on your computer, not on Vercel's servers.

## The Solution

You need to set up a **production PostgreSQL database** and configure Vercel to use it.

---

## Quick Steps (5-10 minutes)

### Step 1: Create a Production Database

Choose **ONE** of these options (Vercel Postgres is easiest):

#### Option A: Vercel Postgres (Recommended) ‚≠ê

1. Go to https://vercel.com/dashboard
2. Select your CourseForge AI project
3. Click **"Storage"** tab
4. Click **"Create Database"** ‚Üí **"Postgres"**
5. Name it "courseforge-db"
6. Click **"Create"**
7. ‚úÖ Vercel automatically sets the `DATABASE_URL` for you!
8. Go to Step 2 below

#### Option B: Supabase (Free Alternative)

1. Go to https://supabase.com
2. Create account ‚Üí **"New Project"**
3. Name: courseforge-db, Password: (save it!), Region: (pick closest)
4. Wait 2-3 minutes for setup
5. Go to **Settings** ‚Üí **Database** ‚Üí Copy the **"URI"** connection string
6. Replace `[YOUR-PASSWORD]` in the string with your password
7. Go to Vercel ‚Üí Settings ‚Üí Environment Variables
8. Edit `DATABASE_URL` ‚Üí Paste the connection string ‚Üí Save
9. Go to Step 2 below

#### Option C: Neon (Another Free Option)

1. Go to https://neon.tech
2. Create account ‚Üí **"Create a project"**
3. Name: courseforge-db
4. Copy the connection string from the dashboard
5. Go to Vercel ‚Üí Settings ‚Üí Environment Variables
6. Edit `DATABASE_URL` ‚Üí Paste the connection string ‚Üí Save
7. Go to Step 2 below

### Step 2: Set Up Database Tables

You need to create the database schema in your production database.

**Option A: Using Vercel CLI (Recommended)**

```bash
# Install Vercel CLI
npm install -g vercel

# Login
vercel login

# Link your project
cd /path/to/courseforgeaipro
vercel link

# Pull environment variables
vercel env pull .env.production

# Run migrations
DATABASE_URL=$(cat .env.production | grep DATABASE_URL | cut -d '=' -f2-) npx prisma db push

# Create admin user
DATABASE_URL=$(cat .env.production | grep DATABASE_URL | cut -d '=' -f2-) npm run db:seed
```

**Option B: Using SQL directly**

If CLI doesn't work, go to your database provider's web interface (SQL editor) and run:

```sql
-- This creates all tables - paste into your database SQL editor
-- (The full SQL is generated by: npx prisma migrate diff --from-empty --to-schema-datamodel prisma/schema.prisma --script)

-- Then create an admin user:
INSERT INTO "User" (id, email, name, password, role, "createdAt", "updatedAt", "usageResetDate", "coursesCreatedThisMonth", "videosCreatedThisMonth", "quizzesCreatedThisMonth")
VALUES (
  'admin-' || gen_random_uuid()::text,
  'admin@courseforgeai.org',
  'Admin User',
  '$2b$12$XBQhWxATC27uDwk8ri69Xe05Xjcd/Uu04vOj7gH8Eaw7Dfb51eh1y', -- Password: Admin123! (bcrypt hash)
  'admin',
  NOW(),
  NOW(),
  NOW(),
  0,
  0,
  0
);
```

### Step 3: Redeploy

1. Go to Vercel dashboard ‚Üí **Deployments** tab
2. Click **three dots (...)** on the latest deployment ‚Üí **"Redeploy"**
3. Confirm and wait 1-2 minutes

### Step 4: Test

1. Go to https://www.courseforgeai.org/register
2. Create a test account
3. Login
4. ‚úÖ It should work!

---

## Verify Your Setup

In Vercel ‚Üí Settings ‚Üí Environment Variables, make sure these are set:

- ‚úÖ **DATABASE_URL** = `postgresql://...` (NOT `prisma+postgres://localhost:...`)
- ‚úÖ **NEXTAUTH_URL** = `https://courseforgeai.org` or `https://www.courseforgeai.org`
- ‚úÖ **NEXTAUTH_SECRET** = (a random string)

---

## Still Having Issues?

See the detailed guide: [PRODUCTION_DATABASE_SETUP.md](./PRODUCTION_DATABASE_SETUP.md)

Common issues:
- **"DATABASE_URL not found"** ‚Üí Make sure you saved it in Vercel and redeployed
- **"Tables don't exist"** ‚Üí Run Step 2 again (database migrations)
- **"Connection timeout"** ‚Üí Your database firewall might be blocking Vercel

---

## Why This Happens

**Local Development:**
- Uses `npx prisma dev` which creates a local database
- Connection: `prisma+postgres://localhost:51213/...`
- Works on your computer only ‚úÖ

**Production:**
- Needs a real PostgreSQL database accessible from the internet
- Connection: `postgresql://user:pass@host:5432/db`
- Works on your live website ‚úÖ

You **cannot** use local development URLs in production!

---

## Summary

1. ‚úÖ Create production database (Vercel Postgres, Supabase, or Neon)
2. ‚úÖ Set DATABASE_URL in Vercel environment variables
3. ‚úÖ Run database migrations (`npx prisma db push`)
4. ‚úÖ Create admin user (`npm run db:seed`)
5. ‚úÖ Redeploy on Vercel
6. ‚úÖ Test on www.courseforgeai.org

That's it! üöÄ
